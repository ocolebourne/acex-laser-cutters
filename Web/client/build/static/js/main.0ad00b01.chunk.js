(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{144:function(e,t,a){},232:function(e,t,a){},373:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),s=a(29),r=a.n(s),i=(a(144),a(5)),o=(a.p,a(232),a(221)),l=a(15),d=a(85),j=a.n(d),u=a(200),b=a(380),h=a(381),O=a(216),x=a(217),m=a(108),f=a(223),p=a(201),v=a(391),g=a(385),y=a(394),S=a(386),k=a(392),w=a(387),C=a(388),N=a(1);function T(e){var t=c.a.useState(0),a=Object(i.a)(t,2),n=a[0],s=(a[1],c.a.useState({})),r=Object(i.a)(s,2),o=r[0],l=r[1];function d(){return(d=Object(u.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/api/getchart1data",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw console.log("Error updating Chart1"),new Error(e.statusText)})).then((function(e){console.log(e),l(e)})).catch((function(e){console.log(e),l({gas:[{value:14,time:1503617297689},{value:15,time:1503616962277},{value:15,time:1503616882654},{value:20,time:1503613184594},{value:15,time:1503611308914}],cutter0:[{value:1,time:1503617247689},{value:0,time:1503616965277},{value:1,time:1503616882254},{value:1,time:1503613134594},{value:0,time:1503611305914}],cutter1:[{value:1,time:1503617247389},{value:1,time:1503616965477},{value:0,time:1503616882454},{value:1,time:1503613133594},{value:1,time:1503611305414}]})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return c.a.useEffect((function(){!function(){d.apply(this,arguments)}();var e=setInterval((function(){console.log("Refreshing Chart 1")}),12e4);return function(){return clearInterval(e)}}),[]),Object(N.jsx)(p.a,{xs:12,children:Object(N.jsxs)("div",{className:"dash-card",children:[Object(N.jsx)("h3",{children:"Usage vs Gas"}),Object(N.jsx)(b.a,{width:"95%",height:500,children:Object(N.jsxs)(h.a,{children:[Object(N.jsx)(O.a,{dataKey:"dt",domain:["auto","auto"],name:"Time",tickFormatter:function(e){return new Date(e).toLocaleString()},type:"number"}),Object(N.jsx)(x.a,{yAxisId:"left",dataKey:"value",name:"Gas",label:{value:"Gas",angle:-90,position:"insideLeft"}}),Object(N.jsx)(x.a,{yAxisId:"right",dataKey:"status",name:"Usage",orientation:"right",tickFormatter:function(e){return e?"In use":"Available"},tickCount:2,label:{value:"Laser cutter usage",angle:-90,position:"center"}}),Object(N.jsx)(m.a,{formatter:function(e){return e>1e6?new Date(e).toLocaleString():1==e?"In use":0==e?"Available":e}}),Object(N.jsx)(f.a,{yAxisId:"left",data:o.gas,line:{stroke:"#8884d8"},fill:"#8884d8",lineJointType:"monotoneX",lineType:"joint",name:"Gas"}),Object(N.jsx)(f.a,{yAxisId:"right",data:o.cutter0,line:{stroke:"#82ca9d"},fill:"#82ca9d",lineJointType:"monotoneX",lineType:"joint",name:"Usage"}),Object(N.jsx)(f.a,{yAxisId:"right",data:o.cutter1,line:{stroke:"#82ca4d"},fill:"#82ca9d",lineJointType:"monotoneX",lineType:"joint",name:"Usage"})]})}),Object(N.jsx)(v.a,{placement:"top",overlay:Object(N.jsx)(g.a,{id:"tooltip-chart1",children:"Click to refresh"}),children:Object(N.jsxs)("a",{className:"mla mt10 update-text",alt:"Click to refresh",children:["Updated ",n,"mins ago"]})},"chart1")]})})}var I=function(e){var t=c.a.useState([]),a=Object(i.a)(t,2),n=a[0],s=a[1],r=c.a.useState(0),o=Object(i.a)(r,2);return o[0],o[1],c.a.useEffect((function(){fetch("/api/getdevicestatuses",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw console.log("Error retrieving devices"),new Error(e.statusText)})).then((function(e){console.log(e),s(e)})).catch((function(e){s([{index:0,name:"abc3.50",nickname:"Left Laser Cutter",status:1},{index:1,name:"def4.60",nickname:"Right Laser Cutter",status:0}]),console.log(e)}));var e=setInterval((function(){console.log("refreshing devices")}),15e3);return function(){return clearInterval(e)}}),[]),Object(N.jsxs)("div",{id:"home",children:[Object(N.jsx)(y.a,{bg:"dark",variant:"dark",expand:"lg",fixed:"top",children:Object(N.jsxs)(S.a,{children:[Object(N.jsx)(y.a.Brand,{href:"",children:"AceX Laser Cutters"}),Object(N.jsx)(y.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(N.jsx)(y.a.Collapse,{id:"basic-navbar-nav",children:Object(N.jsxs)(k.a,{className:"me-auto",children:[Object(N.jsx)(k.a.Link,{href:"#home",children:"Dashboard"}),Object(N.jsx)(k.a.Link,{href:"#charts",children:"Charts"})]})})]})}),Object(N.jsxs)(S.a,{children:[Object(N.jsx)("h1",{className:"mt75",children:"Welcome"}),Object(N.jsx)(w.a,{className:"justify-content-md-left mt30",children:n.map((function(e,t){return Object(N.jsx)(p.a,{xs:12,md:6,children:Object(N.jsxs)("div",{className:"dash-card",children:[Object(N.jsx)(C.a,{className:"laser-icon",fluid:!0,src:"./laser-cutter-icon.png",alt:" "}),Object(N.jsx)("h3",{children:e.name}),Object(N.jsxs)("h3",{children:["Status:"," ",e.status?Object(N.jsx)("b",{className:"in-use-text",children:"in use"}):Object(N.jsx)("b",{className:"available-text",children:"available"})]})]})})}))})]}),Object(N.jsxs)(S.a,{id:"charts",children:[Object(N.jsx)("h1",{children:"Charts"}),Object(N.jsx)(w.a,{className:"justify-content-md-left mt30",children:Object(N.jsx)(T,{})})]})]})},E=a(2),A=a(396),B=a(393),L=a(389),F=a(390);function P(e){var t=c.a.useState(!1),a=Object(i.a)(t,2),n=a[0],s=a[1],r=c.a.useState(""),o=Object(i.a)(r,2),l=o[0],d=o[1],j=c.a.useState(!1),u=Object(i.a)(j,2),b=u[0],h=u[1],O=c.a.useState(!1),x=Object(i.a)(O,2),m=x[0],f=x[1],v=c.a.useState(!1),g=Object(i.a)(v,2),y=g[0],S=g[1],k=c.a.useState(!1),C=Object(i.a)(k,2),T=C[0],I=C[1],F=c.a.useState(!1),P=Object(i.a)(F,2),H=P[0],G=P[1],D=c.a.useState(!1),R=Object(i.a)(D,2),J=R[0],K=R[1],M=c.a.useState(""),z=Object(i.a)(M,2),_=z[0],X=z[1],V=c.a.useRef(),W=c.a.useRef(),q=function(e){if(Q(),"Enter"===e.key)if(b){if(e.preventDefault(),console.log(V.current.value),10===V.current.value.length){console.log("here");var t=V.current.value;d(t)}}else Y(),n(!0)};function Q(){S(!1),I(!1),G(!1),K(!1),s(!1)}function Y(){var t=W.current.value,a=V.current.value;if(t||a){s(!0);var n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))}};a?n.body=JSON.stringify({card_id:a}):t&&(n.body=JSON.stringify({short_code:t})),fetch("/api/delUser",n).then((function(n){if(n.ok)f(!1),S(!0),setTimeout((function(){e.onHide(),Q(),d("")}),2e3);else{if(403===n.status)throw console.log("Auth token bad"),Q(),d(""),e.kick(),new Error(n.statusText);if(404===n.status)throw console.log("User not found"),X("User not found, try again"),d(""),a?K(!0):t&&G(!0),new Error(n.statusText)}})).catch((function(e){console.log(e),s(!1),f(!1),I(!0)}))}else X("Please enter valid user details"),G(!0),K(!0)}return c.a.useEffect((function(){b&&(V.current.value="",V.current.focus(),S(!1),I(!1),G(!1),K(!1),d(""))}),[b]),Object(N.jsxs)(A.a,Object(E.a)(Object(E.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(N.jsx)("input",{className:"scanner-input",ref:V,onKeyPress:q,onBlur:function(){return h(!1)}}),Object(N.jsx)(A.a.Header,{closeButton:!0,children:Object(N.jsx)(A.a.Title,{id:"contained-modal-title-vcenter",children:"Delete User"})}),Object(N.jsxs)(A.a.Body,{children:[Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"Short code"}),Object(N.jsx)(B.a.Control,{type:"text",placeholder:"e.g. ab1234",readOnly:!!n,onKeyPress:q,ref:W,isInvalid:H}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:_})]}),Object(N.jsx)("h5",{className:"mb20",children:"OR"}),Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"Card ID"}),Object(N.jsxs)(w.a,{children:[Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)(L.a,{className:"scanner-button",onClick:function(){return h(!0)},variant:"primary",disabled:!(!b&&!n),children:b?"Scan card":"Enable Scanner"})}),Object(N.jsxs)(p.a,{children:[Object(N.jsx)(B.a.Control,{type:"password",placeholder:"",value:l,readOnly:!0,isInvalid:J}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:_})]})]})]})]}),Object(N.jsx)(U,{loadingSpinner:m,showErrorMessage:T,showSuccessMessage:y,readOnly:n,onSubmit:Y,onHide:e.onHide,cancel:"Cancel",actionButton:"Delete User",actionButtonRed:!0})]}))}function H(e){var t=c.a.useState(!1),a=Object(i.a)(t,2),n=a[0],s=a[1],r=c.a.useState(!1),o=Object(i.a)(r,2),l=o[0],d=o[1],j=c.a.useState(!1),u=Object(i.a)(j,2),b=u[0],h=u[1],O=c.a.useState(!1),x=Object(i.a)(O,2),m=x[0],f=x[1],p=c.a.useState(!1),v=Object(i.a)(p,2),g=v[0],y=v[1],S=c.a.useRef(),k=c.a.useRef(),w=function(e){f(!1),y(!1),h(!1),"Enter"===e.key&&C()};function C(){s(!0);var t=S.current.value,a=k.current.value,n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))},body:JSON.stringify({old_password:t,new_password:a})};fetch("/api/changepass",n).then((function(t){if(t.ok)d(!1),f(!0),setTimeout((function(){e.onHide(),s(!1),f(!1)}),2e3);else{if(401===t.status)throw console.log("Incorrect old password"),h(!0),new Error(t.statusText);if(403===t.status)throw console.log("Auth token bad"),e.kick(),new Error(t.statusText)}})).catch((function(e){console.log(e),s(!1),d(!1),y(!0)}))}return Object(N.jsxs)(A.a,Object(E.a)(Object(E.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(N.jsx)(A.a.Header,{closeButton:!0,children:Object(N.jsx)(A.a.Title,{id:"contained-modal-title-vcenter",children:"Change Admin Password"})}),Object(N.jsx)(A.a.Body,{children:Object(N.jsxs)(B.a,{children:[Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"Old password"}),Object(N.jsx)(B.a.Control,{type:"password",placeholder:"",readOnly:!!n,ref:S,isInvalid:b,isValid:m,onKeyPress:w}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:"Incorrect old password, try again"})]}),Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"New password"}),Object(N.jsx)(B.a.Control,{type:"password",placeholder:"",readOnly:!!n,ref:k,onKeyPress:w,isValid:m})]})]})}),Object(N.jsx)(U,{loadingSpinner:l,showErrorMessage:g,showSuccessMessage:m,readOnly:n,onSubmit:C,onHide:e.onHide,cancel:"Cancel",actionButton:"Change Password"})]}))}function G(e){var t=c.a.useState(!1),a=Object(i.a)(t,2),n=a[0],s=a[1],r=c.a.useState(""),o=Object(i.a)(r,2),l=o[0],d=o[1],j=c.a.useState(!1),u=Object(i.a)(j,2),b=u[0],h=u[1],O=c.a.useState(!1),x=Object(i.a)(O,2),m=x[0],f=x[1],v=c.a.useState(!1),g=Object(i.a)(v,2),y=g[0],S=g[1],k=c.a.useState(!1),C=Object(i.a)(k,2),T=C[0],I=C[1],F=c.a.useState(!1),P=Object(i.a)(F,2),H=P[0],G=P[1],D=c.a.useState(!1),R=Object(i.a)(D,2),J=R[0],K=R[1],M=c.a.useRef(),z=c.a.useRef(),_=function(e){if(X(),"Enter"===e.key)if(b){if(e.preventDefault(),console.log(M.current.value),10===M.current.value.length){console.log("here");var t=M.current.value;d(t)}}else V(),n(!0)};function X(){S(!1),I(!1),G(!1),K(!1),s(!1)}function V(){var t=z.current.value,a=M.current.value;if(t)if(a){s(!0);var n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))},body:JSON.stringify({short_code:t,card_id:a})};fetch("/api/addUser",n).then((function(t){if(t.ok)f(!1),S(!0),setTimeout((function(){e.onHide(),d(""),X()}),2e3);else if(403===t.status)throw console.log("Auth token bad"),e.kick(),new Error(t.statusText)})).catch((function(e){console.log(e),s(!1),f(!1),I(!0)}))}else K(!0);else G(!0)}return c.a.useEffect((function(){b&&(M.current.value="",M.current.focus(),X(),d(""))}),[b]),Object(N.jsxs)(A.a,Object(E.a)(Object(E.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(N.jsx)("input",{className:"scanner-input",ref:M,onKeyPress:_,onBlur:function(){return h(!1)}}),Object(N.jsx)(A.a.Header,{closeButton:!0,children:Object(N.jsx)(A.a.Title,{id:"contained-modal-title-vcenter",children:"Add User"})}),Object(N.jsxs)(A.a.Body,{children:[Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"Short code"}),Object(N.jsx)(B.a.Control,{type:"text",placeholder:"e.g. ab1234",readOnly:!!n,onKeyPress:_,ref:z,isInvalid:H}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:"Please enter a short code."})]}),Object(N.jsxs)(B.a.Group,{className:"mb-3",children:[Object(N.jsx)(B.a.Label,{children:"Card ID"}),Object(N.jsxs)(w.a,{children:[Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)(L.a,{className:"scanner-button",onClick:function(){return h(!0)},variant:"primary",disabled:!(!b&&!n),children:b?"Scan card":"Enable Scanner"})}),Object(N.jsxs)(p.a,{children:[Object(N.jsx)(B.a.Control,{type:"password",placeholder:"",value:l,readOnly:!0,isInvalid:J}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:"Please add a card ID."})]})]})]})]}),Object(N.jsx)(U,{loadingSpinner:m,showErrorMessage:T,showSuccessMessage:y,readOnly:n,onSubmit:V,onHide:e.onHide,cancel:"Cancel",actionButton:"Add User"})]}))}function U(e){return Object(N.jsxs)(A.a.Footer,{children:[e.loadingSpinner?Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)(F.a,{className:"mra",animation:"border"})}):Object(N.jsx)(N.Fragment,{}),e.showSuccessMessage?Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)("div",{className:"mra success-message",children:"Success"})}):Object(N.jsx)(N.Fragment,{}),e.showErrorMessage?Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)("div",{className:"mra error-message",children:"Error"})}):Object(N.jsx)(N.Fragment,{}),Object(N.jsx)(L.a,{variant:"secondary",onClick:e.onHide,className:"mla",children:e.cancel}),Object(N.jsx)(L.a,{variant:e.actionButtonRed?"danger":"primary",type:"submit",onClick:function(){return e.onSubmit()},disabled:!!e.readOnly,children:e.actionButton})]})}var D=function(e){var t=c.a.useState(!1),a=Object(i.a)(t,2),n=a[0],s=a[1],r=c.a.useState(!1),o=Object(i.a)(r,2),l=o[0],d=o[1],j=c.a.useState(!1),u=Object(i.a)(j,2),b=u[0],h=u[1],O=c.a.useState(!1),x=Object(i.a)(O,2),m=x[0],f=x[1],v=c.a.useState(!1),g=Object(i.a)(v,2),C=g[0],T=g[1],I=c.a.useState(!1),E=Object(i.a)(I,2),A=E[0],U=E[1],D=c.a.useState(""),R=Object(i.a)(D,2),J=R[0],K=R[1],M=c.a.useState(!1),z=Object(i.a)(M,2),_=z[0],X=z[1],V=c.a.useState(!1),W=Object(i.a)(V,2),q=W[0],Q=W[1],Y=c.a.useRef();function Z(){var e=Y.current.value;X(!0),T(!0);var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})};fetch("/api/login",t).then((function(e){return e.json()})).then((function(e){X(!1),sessionStorage.setItem("token",e.token),T(!1),f(!0)})).catch((function(e){console.log(e),X(!1),T(!1),U(!0),K("Incorrect password, try again")}))}function $(){sessionStorage.removeItem("token"),f(!1),Q(!0)}return c.a.useEffect((function(){sessionStorage.getItem("token")&&f(!0)}),[]),Object(N.jsxs)("div",{children:[Object(N.jsx)(y.a,{bg:"light",children:Object(N.jsxs)(S.a,{children:[Object(N.jsx)(y.a.Brand,{href:"",children:"AceX Admin"}),m?Object(N.jsx)(k.a.Link,{onClick:function(){return sessionStorage.removeItem("token"),void f(!1)},children:"Logout"}):Object(N.jsx)(N.Fragment,{})]})}),m?Object(N.jsxs)(S.a,{children:[Object(N.jsx)("h1",{children:"Welcome"}),Object(N.jsxs)(w.a,{className:"justify-content-md-left mt50",children:[Object(N.jsx)(p.a,{xs:6,md:4,xl:3,children:Object(N.jsx)("div",{onClick:function(){return s(!0)},className:"admin-card",children:Object(N.jsx)("h2",{className:"mta",children:"Add user"})})}),Object(N.jsx)(p.a,{xs:6,md:4,xl:3,children:Object(N.jsx)("div",{onClick:function(){return d(!0)},className:"admin-card",children:Object(N.jsx)("h2",{className:"mta",children:"Delete user"})})}),Object(N.jsx)(p.a,{xs:6,md:4,xl:3,children:Object(N.jsx)("div",{onClick:function(){return h(!0)},className:"admin-card",children:Object(N.jsx)("h2",{className:"mta",children:"Change password"})})})]}),Object(N.jsx)(G,{show:n,onHide:function(){return s(!1)},kick:function(){return $()}}),Object(N.jsx)(P,{show:l,onHide:function(){return d(!1)},kick:function(){return $()}}),Object(N.jsx)(H,{show:b,onHide:function(){return h(!1)},kick:function(){return $()}})]}):Object(N.jsxs)(S.a,{children:[Object(N.jsx)("h1",{children:"Please enter the admin password"}),Object(N.jsxs)(B.a.Group,{className:"mt50 mb-3",children:[q?Object(N.jsx)("div",{className:"mb10 error-message",children:"Session expired, please log in again"}):Object(N.jsx)(N.Fragment,{children:" "}),Object(N.jsxs)(w.a,{children:[Object(N.jsxs)(p.a,{xs:"9",md:"4",children:[Object(N.jsx)(B.a.Control,{type:"password",placeholder:"",readOnly:!!C,ref:Y,onKeyPress:function(e){U(!1),"Enter"===e.key&&Z()},isInvalid:A}),Object(N.jsx)(B.a.Control.Feedback,{type:"invalid",children:J})]}),Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)(L.a,{onClick:function(){return Z()},type:"submit",disabled:!!C,children:"Login"})}),_?Object(N.jsx)(p.a,{xs:"auto",children:Object(N.jsx)(F.a,{animation:"border"})}):Object(N.jsx)(N.Fragment,{})]})]})]})]})};var R=function(){var e=c.a.useState(null),t=Object(i.a)(e,2);return t[0],t[1],Object(N.jsx)(o.a,{className:"App",children:Object(N.jsxs)(l.c,{children:[Object(N.jsx)(l.a,{path:"/admin",element:Object(N.jsx)(D,{})}),Object(N.jsx)(l.a,{path:"/",element:Object(N.jsx)(I,{})})]})})},J=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,397)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))};r.a.render(Object(N.jsx)(c.a.StrictMode,{children:Object(N.jsx)(R,{})}),document.getElementById("root")),J()}},[[373,1,2]]]);
//# sourceMappingURL=main.0ad00b01.chunk.js.map