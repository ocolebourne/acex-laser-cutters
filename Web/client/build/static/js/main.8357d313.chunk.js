(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{112:function(e,t,a){},254:function(e,t,a){},438:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),c=a(29),r=a.n(c),i=(a(112),a(7)),o=(a.p,a(254),a(239)),l=a(18),d=a(460),j=a(455),u=a(458),b=a(452),h=a(217),O=a(456),x=a(51),f=a.n(x),m=a(150),g=a(447),p=a(448),v=a(108),y=a(232),S=a(233),k=a(111),w=a(241),N=a(453),C=a(454),T=a(234),L=a.n(T),I=(a(256),a(1));function A(e){var t=s.a.useState(0),a=Object(i.a)(t,2),n=(a[0],a[1],s.a.useState({})),c=Object(i.a)(n,2),r=c[0],o=c[1],l=(s.a.useRef(null),s.a.useState([new Date((new Date).getTime()-864e5),new Date])),d=Object(i.a)(l,2),j=d[0],u=d[1],O=s.a.useState(!1),x=Object(i.a)(O,2),T=x[0],A=x[1],E=Object(i.a)(j,2),D=E[0],F=E[1],G=6048e5,R=s.a.useState(!0),P=Object(i.a)(R,2),H=P[0],B=P[1],M=s.a.useState(!0),U=Object(i.a)(M,2),J=U[0],K=U[1],V=s.a.useState(!0),X=Object(i.a)(V,2),z=X[0],_=X[1],W=s.a.useState(!1),Y=Object(i.a)(W,2),Z=Y[0],q=Y[1];function Q(){return(Q=Object(m.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A(!1),!(F.getTime()-D.getTime()>G)){e.next=6;break}return console.log("7 days max"),A(!0),e.next=6,u([D,new Date(D.getTime()+G)]);case 6:$();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return ee.apply(this,arguments)}function ee(){return(ee=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={method:"GET",headers:{"Content-Type":"application/json"}},fetch("/api/getchart1data?"+new URLSearchParams({start:D,end:F}),t).then((function(e){if(e.ok)return e.json();throw console.log("Error updating Chart1"),new Error(e.statusText)})).then((function(e){console.log(e),o(e)})).catch((function(e){console.log(e),o({gas:[{value:14,dt:1503617297689},{value:15,dt:1503616962277},{value:15,dt:1503616882654},{value:20,dt:1503613184594},{value:15,dt:1503611308914}],cutter0:[{status:1,dt:1503617247689},{status:0,dt:1503617248689},{status:0,dt:1503616965277},{status:1,dt:1503616966277},{status:1,dt:1503616882254},{status:0,dt:1503616883254},{status:0,dt:1503613133594},{status:1,dt:1503613134594},{status:1,dt:1503611304914},{status:0,dt:1503611305914}],cutter1:[{status:1,dt:1503617247389},{status:1,dt:1503616965477},{status:0,dt:1503616882454},{status:1,dt:1503613133594},{status:1,dt:1503611305414}]})}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return s.a.useEffect((function(){$()}),[]),Object(I.jsx)(h.a,{xs:12,children:Object(I.jsxs)("div",{className:"dash-card",children:[Object(I.jsx)("h3",{children:"Usage vs Gas: Long-term"}),Object(I.jsx)(g.a,{width:"95%",height:500,children:Object(I.jsxs)(p.a,{children:[Object(I.jsx)(v.a,{verticalAlign:"top",height:50}),Object(I.jsx)(y.a,{dataKey:"dt",domain:["auto","auto"],name:"Time",tickFormatter:function(e){return new Date(e).toLocaleString()},type:"number"}),Object(I.jsx)(S.a,{yAxisId:"left",dataKey:"value",name:"Gas",label:{value:"Gas",angle:-90,position:"insideLeft"},domain:Z?["dataMin","dataMax"]:[0,350]}),Object(I.jsx)(S.a,{yAxisId:"right",dataKey:"status",name:"Usage",orientation:"right",tickFormatter:function(e){return e?"In use":"Available"},tickCount:2,label:{value:"Laser cutter usage",angle:-90,position:"center"}}),Object(I.jsx)(k.a,{formatter:function(e){return e>1e6?new Date(e).toLocaleString():1==e?"In use":0==e?"Available":e}}),z?Object(I.jsx)(w.a,{yAxisId:"left",data:r.gas,line:{stroke:"#8884d8"},fill:"#8884d8",lineJointType:"monotoneX",lineType:"joint",name:"Gas"}):Object(I.jsx)(I.Fragment,{}),H?Object(I.jsx)(w.a,{yAxisId:"right",data:r.cutter0,line:{stroke:"#82ca9d"},fill:"#82ca9d",lineJointType:"monotoneX",lineType:"joint",name:"VLS3.50"}):Object(I.jsx)(I.Fragment,{}),J?Object(I.jsx)(w.a,{yAxisId:"right",data:r.cutter1,line:{stroke:"#82b7ca"},fill:"#82b7ca",lineJointType:"monotoneX",lineType:"joint",name:"VLS4.60"}):Object(I.jsx)(I.Fragment,{})]})}),Object(I.jsxs)(b.a,{style:{width:"100%"},children:[Object(I.jsxs)(h.a,{className:"mt20",children:[Object(I.jsx)(L.a,{dateFormat:"dd/MM/yyy",selectsRange:!0,startDate:D,endDate:F,onChange:function(e){u(e)},withPortal:!0,onCalendarClose:function(){return function(){return Q.apply(this,arguments)}()}}),T?Object(I.jsx)("div",{className:"error-message",children:"Max. 7 days"}):Object(I.jsx)("div",{children:Object(I.jsx)("br",{})})]}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsxs)(N.a,{variant:"secondary",onClick:function(){return q(!Z)},children:["Auto Y: ",Z?"on":"off"]})}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsxs)(C.a,{children:[Object(I.jsx)(N.a,{variant:H?"secondary":"outline-secondary",onClick:function(){return B(!H)},children:"VLS3.50"}),Object(I.jsx)(N.a,{variant:J?"secondary":"outline-secondary",onClick:function(){return K(!J)},children:"VLS4.60"}),Object(I.jsx)(N.a,{variant:z?"secondary":"outline-secondary",onClick:function(){return _(!z)},children:"Gas"})]})}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsx)(N.a,{variant:"secondary",onClick:function(){return $()},children:"Refresh data"})})]})]})})}function E(e){var t=s.a.useState({}),a=Object(i.a)(t,2),n=a[0],c=a[1],r=(new Date).setHours(0,0,0,0),o=s.a.useState(r),l=Object(i.a)(o,2),d=l[0],j=l[1],u=s.a.useState(!1),O=Object(i.a)(u,2),x=O[0],T=O[1],L=s.a.useState(!0),A=Object(i.a)(L,2),E=A[0],D=A[1],F=s.a.useState(!0),G=Object(i.a)(F,2),R=G[0],P=G[1],H=s.a.useState(!0),B=Object(i.a)(H,2),M=B[0],U=B[1];function J(e){var t=new Date(new Date(d).getTime()+864e5*e).toISOString();j(t),K(t)}function K(e){return V.apply(this,arguments)}function V(){return(V=Object(m.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={method:"GET",headers:{"Content-Type":"application/json"}},n={date:new Date(t)},console.log(n),fetch("/api/getchart2data?"+new URLSearchParams(n),a).then((function(e){if(e.ok)return e.json();throw console.log("Error updating Chart2"),new Error(e.statusText)})).then((function(e){console.log(e),c(e)})).catch((function(e){console.log(e),c({gas:[{value:14,dt:1503617297689},{value:15,dt:1503616962277},{value:15,dt:1503616882654},{value:20,dt:1503613184594},{value:15,dt:1503611308914}],cutter0:[{status:1,dt:1503617247689},{status:0,dt:1503617248689},{status:0,dt:1503616965277},{status:1,dt:1503616966277},{status:1,dt:1503616882254},{status:0,dt:1503616883254},{status:0,dt:1503613133594},{status:1,dt:1503613134594},{status:1,dt:1503611304914},{status:0,dt:1503611305914}],cutter1:[{status:1,dt:1503617247389},{status:1,dt:1503616965477},{status:0,dt:1503616882454},{status:1,dt:1503613133594},{status:1,dt:1503611305414}]})}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return s.a.useEffect((function(){K(r)}),[]),Object(I.jsx)(h.a,{xs:12,children:Object(I.jsxs)("div",{className:"dash-card",children:[Object(I.jsx)("h3",{children:"Usage vs Gas: Daily"}),Object(I.jsx)(g.a,{width:"95%",height:500,children:Object(I.jsxs)(p.a,{children:[Object(I.jsx)(v.a,{verticalAlign:"top",height:50}),Object(I.jsx)(y.a,{dataKey:"dt",domain:["auto","auto"],name:"Time",tickFormatter:function(e){return new Date(e).toLocaleString()},type:"number"}),Object(I.jsx)(S.a,{yAxisId:"left",dataKey:"value",name:"Gas",label:{value:"Gas",angle:-90,position:"insideLeft"},domain:x?["dataMin","dataMax"]:[0,350]}),Object(I.jsx)(S.a,{yAxisId:"right",dataKey:"status",name:"Usage",orientation:"right",tickFormatter:function(e){return e?"In use":"Available"},tickCount:2,label:{value:"Laser cutter usage",angle:-90,position:"center"}}),Object(I.jsx)(k.a,{formatter:function(e){return e>1e6?new Date(e).toLocaleString():1==e?"In use":0==e?"Available":e}}),M?Object(I.jsx)(w.a,{yAxisId:"left",data:n.gas,line:{stroke:"#8884d8"},fill:"#8884d8",lineJointType:"monotoneX",lineType:"joint",name:"Gas"}):Object(I.jsx)(I.Fragment,{}),E?Object(I.jsx)(w.a,{yAxisId:"right",data:n.cutter0,line:{stroke:"#82ca9d"},fill:"#82ca9d",lineJointType:"monotoneX",lineType:"joint",name:"VLS3.50"}):Object(I.jsx)(I.Fragment,{}),R?Object(I.jsx)(w.a,{yAxisId:"right",data:n.cutter1,line:{stroke:"#82b7ca"},fill:"#82b7ca",lineJointType:"monotoneX",lineType:"joint",name:"VLS4.60"}):Object(I.jsx)(I.Fragment,{})]})}),Object(I.jsxs)(b.a,{style:{width:"100%"},children:[Object(I.jsxs)(h.a,{className:"graph-tools",children:[Object(I.jsx)(N.a,{variant:"secondary",onClick:function(){return J(-1)},children:"Prev."}),Object(I.jsx)("div",{className:"selected-day",children:new Date(d).toLocaleDateString()}),Object(I.jsx)(N.a,{variant:"secondary",onClick:function(){return J(1)},children:"Next"})]}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsxs)(N.a,{variant:"secondary",onClick:function(){return T(!x)},children:["Auto Y: ",x?"on":"off"]})}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsxs)(C.a,{children:[Object(I.jsx)(N.a,{variant:E?"secondary":"outline-secondary",onClick:function(){return D(!E)},children:"VLS3.50"}),Object(I.jsx)(N.a,{variant:R?"secondary":"outline-secondary",onClick:function(){return P(!R)},children:"VLS4.60"}),Object(I.jsx)(N.a,{variant:M?"secondary":"outline-secondary",onClick:function(){return U(!M)},children:"Gas"})]})}),Object(I.jsx)(h.a,{className:"graph-tools",children:Object(I.jsx)(N.a,{variant:"secondary",onClick:function(){return K(d)},children:"Refresh data"})})]})]})})}var D=function(e){var t=s.a.useState([]),a=Object(i.a)(t,2),n=a[0],c=a[1],r=s.a.useState({}),o=Object(i.a)(r,2),l=o[0],x=o[1];function f(){fetch("/api/getworkshopstats",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw console.log("Error retrieving workshop stats"),new Error(e.statusText)})).then((function(e){console.log(e),x(e)})).catch((function(e){x({lastHourAverage:"27.79",lastGasReadingValue:26,lastGasReadingDt:"2021-12-16T18:46:30Z",usersToday:1,timeUsed:770590,morningThreshold:"31.11",isDangerous:0,isAboveMorning:0}),console.log(e.message)}))}function m(){fetch("/api/getdevicestatuses",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw console.log("Error retrieving devices"),new Error(e.statusText)})).then((function(e){console.log(e),c(e)})).catch((function(e){c([{index:0,name:"abc3.50",nickname:"Left Laser Cutter",status:1},{index:1,name:"def4.60",nickname:"Right Laser Cutter",status:0}]),console.log(e.message)}))}return s.a.useEffect((function(){m(),f();var e=setInterval((function(){m(),f(),console.log("refreshing devices and stats")}),15e3);return function(){return clearInterval(e)}}),[]),Object(I.jsxs)("div",{id:"home",children:[Object(I.jsx)(d.a,{bg:"dark",variant:"dark",expand:"lg",fixed:"top",children:Object(I.jsxs)(j.a,{children:[Object(I.jsx)(d.a.Brand,{href:"",children:"AceX Workshop"}),Object(I.jsx)(d.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(I.jsx)(d.a.Collapse,{id:"basic-navbar-nav",children:Object(I.jsxs)(u.a,{className:"me-auto",children:[Object(I.jsx)(u.a.Link,{href:"#home",children:"Status"}),Object(I.jsx)(u.a.Link,{href:"#data",children:"Data"})]})})]})}),Object(I.jsxs)(j.a,{children:[Object(I.jsx)("h1",{className:"mt75",children:"Status"}),Object(I.jsx)(b.a,{className:"justify-content-md-left mt30",children:n.map((function(e,t){return Object(I.jsx)(h.a,{xs:12,md:6,children:Object(I.jsxs)("div",{className:"dash-card",children:[Object(I.jsx)(O.a,{className:"laser-icon",fluid:!0,src:"./laser-cutter-icon.png",alt:" "}),Object(I.jsx)("h3",{children:e.name}),Object(I.jsxs)("h3",{children:["Status:"," ",e.status?Object(I.jsx)("b",{className:"in-use-text",children:"in use"}):Object(I.jsx)("b",{className:"available-text",children:"available"})]})]})})}))})]}),Object(I.jsxs)(j.a,{id:"data",children:[Object(I.jsx)("h1",{children:"Data"}),Object(I.jsxs)(b.a,{className:"justify-content-md-left mt30",children:[Object(I.jsx)(h.a,{xs:12,md:4,children:Object(I.jsxs)("div",{className:"stats-card",children:[Object(I.jsx)(O.a,{className:"stats-icon",fluid:!0,src:"./user-icon.png",alt:" "}),Object(I.jsxs)("h3",{children:["No. users today: ",l.usersToday]}),Object(I.jsxs)("h3",{children:["Hours in use today:"," ",(l.timeUsed/36e5).toFixed(0),"h",(l.timeUsed/6e4).toFixed(0),"m"]})]})}),Object(I.jsx)(h.a,{xs:12,md:4,children:Object(I.jsxs)("div",{className:"stats-card",children:[Object(I.jsx)(O.a,{className:"stats-icon",fluid:!0,src:"./gas-icon.png",alt:" "}),Object(I.jsxs)("h3",{children:["Last Reading (",new Date(l.lastGasReadingDt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"): ",l.lastGasReadingValue]}),Object(I.jsxs)("h3",{children:["Last hour avg.: ",l.lastHourAverage]})]})}),Object(I.jsx)(h.a,{xs:12,md:4,children:Object(I.jsxs)("div",{className:"stats-card",children:[Object(I.jsx)(O.a,{className:"stats-icon",fluid:!0,src:"./warning-icon.png",alt:" "}),Object(I.jsxs)("h3",{children:["Start of day threshold: ",l.morningThreshold]}),Object(I.jsxs)("h3",{children:["Relative gas level:"," ",l.isDangerous?Object(I.jsx)("b",{className:"error-message",children:"HIGH"}):Object(I.jsx)("b",{className:"success-message",children:l.isAboveMorning?"NORMAL":"LOW"})]})]})})]}),Object(I.jsx)(b.a,{className:"justify-content-md-left mt30",children:Object(I.jsx)(E,{})}),Object(I.jsx)(b.a,{className:"justify-content-md-left mt30",children:Object(I.jsx)(A,{})})]})]})},F=a(3),G=a(462),R=a(459),P=a(457);function H(e){var t=s.a.useState(!1),a=Object(i.a)(t,2),n=a[0],c=a[1],r=s.a.useState(""),o=Object(i.a)(r,2),l=o[0],d=o[1],j=s.a.useState(!1),u=Object(i.a)(j,2),O=u[0],x=u[1],f=s.a.useState(!1),m=Object(i.a)(f,2),g=m[0],p=m[1],v=s.a.useState(!1),y=Object(i.a)(v,2),S=y[0],k=y[1],w=s.a.useState(!1),C=Object(i.a)(w,2),T=C[0],L=C[1],A=s.a.useState(!1),E=Object(i.a)(A,2),D=E[0],P=E[1],H=s.a.useState(!1),B=Object(i.a)(H,2),M=B[0],J=B[1],K=s.a.useState(""),V=Object(i.a)(K,2),X=V[0],z=V[1],_=s.a.useRef(),W=s.a.useRef(),Y=function(e){if(Z(),"Enter"===e.key)if(O){if(e.preventDefault(),console.log(_.current.value),10===_.current.value.length){console.log("here");var t=_.current.value;d(t)}}else q(),n(!0)};function Z(){k(!1),L(!1),P(!1),J(!1),c(!1)}function q(){var t=W.current.value,a=_.current.value;if(t||a){c(!0);var n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))}};a?n.body=JSON.stringify({card_id:a}):t&&(n.body=JSON.stringify({short_code:t})),fetch("/api/delUser",n).then((function(n){if(n.ok)p(!1),k(!0),setTimeout((function(){e.onHide(),Z(),d("")}),2e3);else{if(403===n.status)throw console.log("Auth token bad"),Z(),d(""),e.kick(),new Error(n.statusText);if(404===n.status)throw console.log("User not found"),z("User not found, try again"),d(""),a?J(!0):t&&P(!0),new Error(n.statusText)}})).catch((function(e){console.log(e),c(!1),p(!1),L(!0)}))}else z("Please enter valid user details"),P(!0),J(!0)}return s.a.useEffect((function(){O&&(_.current.value="",_.current.focus(),k(!1),L(!1),P(!1),J(!1),d(""))}),[O]),Object(I.jsxs)(G.a,Object(F.a)(Object(F.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(I.jsx)("input",{className:"scanner-input",ref:_,onKeyPress:Y,onBlur:function(){return x(!1)}}),Object(I.jsx)(G.a.Header,{closeButton:!0,children:Object(I.jsx)(G.a.Title,{id:"contained-modal-title-vcenter",children:"Delete User"})}),Object(I.jsxs)(G.a.Body,{children:[Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"Short code"}),Object(I.jsx)(R.a.Control,{type:"text",placeholder:"e.g. ab1234",readOnly:!!n,onKeyPress:Y,ref:W,isInvalid:D}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:X})]}),Object(I.jsx)("h5",{className:"mb20",children:"OR"}),Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"Card ID"}),Object(I.jsxs)(b.a,{children:[Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)(N.a,{className:"scanner-button",onClick:function(){return x(!0)},variant:"primary",disabled:!(!O&&!n),children:O?"Scan card":"Enable Scanner"})}),Object(I.jsxs)(h.a,{children:[Object(I.jsx)(R.a.Control,{type:"password",placeholder:"",value:l,readOnly:!0,isInvalid:M}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:X})]})]})]})]}),Object(I.jsx)(U,{loadingSpinner:g,showErrorMessage:T,showSuccessMessage:S,readOnly:n,onSubmit:q,onHide:e.onHide,cancel:"Cancel",actionButton:"Delete User",actionButtonRed:!0})]}))}function B(e){var t=s.a.useState(!1),a=Object(i.a)(t,2),n=a[0],c=a[1],r=s.a.useState(!1),o=Object(i.a)(r,2),l=o[0],d=o[1],j=s.a.useState(!1),u=Object(i.a)(j,2),b=u[0],h=u[1],O=s.a.useState(!1),x=Object(i.a)(O,2),f=x[0],m=x[1],g=s.a.useState(!1),p=Object(i.a)(g,2),v=p[0],y=p[1],S=s.a.useRef(),k=s.a.useRef(),w=function(e){m(!1),y(!1),h(!1),"Enter"===e.key&&N()};function N(){c(!0);var t=S.current.value,a=k.current.value,n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))},body:JSON.stringify({old_password:t,new_password:a})};fetch("/api/changepass",n).then((function(t){if(t.ok)d(!1),m(!0),setTimeout((function(){e.onHide(),c(!1),m(!1)}),2e3);else{if(401===t.status)throw console.log("Incorrect old password"),h(!0),new Error(t.statusText);if(403===t.status)throw console.log("Auth token bad"),e.kick(),new Error(t.statusText)}})).catch((function(e){console.log(e),c(!1),d(!1),y(!0)}))}return Object(I.jsxs)(G.a,Object(F.a)(Object(F.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(I.jsx)(G.a.Header,{closeButton:!0,children:Object(I.jsx)(G.a.Title,{id:"contained-modal-title-vcenter",children:"Change Admin Password"})}),Object(I.jsx)(G.a.Body,{children:Object(I.jsxs)(R.a,{children:[Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"Old password"}),Object(I.jsx)(R.a.Control,{type:"password",placeholder:"",readOnly:!!n,ref:S,isInvalid:b,isValid:f,onKeyPress:w}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:"Incorrect old password, try again"})]}),Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"New password"}),Object(I.jsx)(R.a.Control,{type:"password",placeholder:"",readOnly:!!n,ref:k,onKeyPress:w,isValid:f})]})]})}),Object(I.jsx)(U,{loadingSpinner:l,showErrorMessage:v,showSuccessMessage:f,readOnly:n,onSubmit:N,onHide:e.onHide,cancel:"Cancel",actionButton:"Change Password"})]}))}function M(e){var t=s.a.useState(!1),a=Object(i.a)(t,2),n=a[0],c=a[1],r=s.a.useState(""),o=Object(i.a)(r,2),l=o[0],d=o[1],j=s.a.useState(!1),u=Object(i.a)(j,2),O=u[0],x=u[1],f=s.a.useState(!1),m=Object(i.a)(f,2),g=m[0],p=m[1],v=s.a.useState(!1),y=Object(i.a)(v,2),S=y[0],k=y[1],w=s.a.useState(!1),C=Object(i.a)(w,2),T=C[0],L=C[1],A=s.a.useState(!1),E=Object(i.a)(A,2),D=E[0],P=E[1],H=s.a.useState(!1),B=Object(i.a)(H,2),M=B[0],J=B[1],K=s.a.useRef(),V=s.a.useRef(),X=function(e){if(z(),"Enter"===e.key)if(O){if(e.preventDefault(),console.log(K.current.value),10===K.current.value.length){console.log("here");var t=K.current.value;d(t)}}else _(),n(!0)};function z(){k(!1),L(!1),P(!1),J(!1),c(!1)}function _(){var t=V.current.value,a=K.current.value;if(t)if(a){c(!0);var n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(sessionStorage.getItem("token"))},body:JSON.stringify({short_code:t,card_id:a})};fetch("/api/addUser",n).then((function(t){if(t.ok)p(!1),k(!0),setTimeout((function(){e.onHide(),d(""),z()}),2e3);else if(403===t.status)throw console.log("Auth token bad"),e.kick(),new Error(t.statusText)})).catch((function(e){console.log(e),c(!1),p(!1),L(!0)}))}else J(!0);else P(!0)}return s.a.useEffect((function(){O&&(K.current.value="",K.current.focus(),z(),d(""))}),[O]),Object(I.jsxs)(G.a,Object(F.a)(Object(F.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(I.jsx)("input",{className:"scanner-input",ref:K,onKeyPress:X,onBlur:function(){return x(!1)}}),Object(I.jsx)(G.a.Header,{closeButton:!0,children:Object(I.jsx)(G.a.Title,{id:"contained-modal-title-vcenter",children:"Add User"})}),Object(I.jsxs)(G.a.Body,{children:[Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"Short code"}),Object(I.jsx)(R.a.Control,{type:"text",placeholder:"e.g. ab1234",readOnly:!!n,onKeyPress:X,ref:V,isInvalid:D}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:"Please enter a short code."})]}),Object(I.jsxs)(R.a.Group,{className:"mb-3",children:[Object(I.jsx)(R.a.Label,{children:"Card ID"}),Object(I.jsxs)(b.a,{children:[Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)(N.a,{className:"scanner-button",onClick:function(){return x(!0)},variant:"primary",disabled:!(!O&&!n),children:O?"Scan card":"Enable Scanner"})}),Object(I.jsxs)(h.a,{children:[Object(I.jsx)(R.a.Control,{type:"password",placeholder:"",value:l,readOnly:!0,isInvalid:M}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:"Please add a card ID."})]})]})]})]}),Object(I.jsx)(U,{loadingSpinner:g,showErrorMessage:T,showSuccessMessage:S,readOnly:n,onSubmit:_,onHide:e.onHide,cancel:"Cancel",actionButton:"Add User"})]}))}function U(e){return Object(I.jsxs)(G.a.Footer,{children:[e.loadingSpinner?Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)(P.a,{className:"mra",animation:"border"})}):Object(I.jsx)(I.Fragment,{}),e.showSuccessMessage?Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)("div",{className:"mra success-message",children:"Success"})}):Object(I.jsx)(I.Fragment,{}),e.showErrorMessage?Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)("div",{className:"mra error-message",children:"Error"})}):Object(I.jsx)(I.Fragment,{}),Object(I.jsx)(N.a,{variant:"secondary",onClick:e.onHide,className:"mla",children:e.cancel}),Object(I.jsx)(N.a,{variant:e.actionButtonRed?"danger":"primary",type:"submit",onClick:function(){return e.onSubmit()},disabled:!!e.readOnly,children:e.actionButton})]})}var J=function(e){var t=s.a.useState(!1),a=Object(i.a)(t,2),n=a[0],c=a[1],r=s.a.useState(!1),o=Object(i.a)(r,2),l=o[0],O=o[1],x=s.a.useState(!1),f=Object(i.a)(x,2),m=f[0],g=f[1],p=s.a.useState(!1),v=Object(i.a)(p,2),y=v[0],S=v[1],k=s.a.useState(!1),w=Object(i.a)(k,2),C=w[0],T=w[1],L=s.a.useState(!1),A=Object(i.a)(L,2),E=A[0],D=A[1],F=s.a.useState(""),G=Object(i.a)(F,2),U=G[0],J=G[1],K=s.a.useState(!1),V=Object(i.a)(K,2),X=V[0],z=V[1],_=s.a.useState(!1),W=Object(i.a)(_,2),Y=W[0],Z=W[1],q=s.a.useRef();function Q(){var e=q.current.value;z(!0),T(!0);var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})};fetch("/api/login",t).then((function(e){return e.json()})).then((function(e){z(!1),sessionStorage.setItem("token",e.token),T(!1),S(!0)})).catch((function(e){console.log(e),z(!1),T(!1),D(!0),J("Incorrect password, try again")}))}function $(){sessionStorage.removeItem("token"),S(!1),Z(!0)}return s.a.useEffect((function(){sessionStorage.getItem("token")&&S(!0)}),[]),Object(I.jsxs)("div",{children:[Object(I.jsx)(d.a,{bg:"light",children:Object(I.jsxs)(j.a,{children:[Object(I.jsx)(d.a.Brand,{href:"",children:"AceX Admin"}),y?Object(I.jsx)(u.a.Link,{onClick:function(){return sessionStorage.removeItem("token"),void S(!1)},children:"Logout"}):Object(I.jsx)(I.Fragment,{})]})}),y?Object(I.jsxs)(j.a,{children:[Object(I.jsx)("h1",{children:"Welcome"}),Object(I.jsxs)(b.a,{className:"justify-content-md-left mt50",children:[Object(I.jsx)(h.a,{xs:6,md:4,xl:3,children:Object(I.jsx)("div",{onClick:function(){return c(!0)},className:"admin-card",children:Object(I.jsx)("h2",{className:"mta",children:"Add user"})})}),Object(I.jsx)(h.a,{xs:6,md:4,xl:3,children:Object(I.jsx)("div",{onClick:function(){return O(!0)},className:"admin-card",children:Object(I.jsx)("h2",{className:"mta",children:"Delete user"})})}),Object(I.jsx)(h.a,{xs:6,md:4,xl:3,children:Object(I.jsx)("div",{onClick:function(){return g(!0)},className:"admin-card",children:Object(I.jsx)("h2",{className:"mta",children:"Change password"})})})]}),Object(I.jsx)(M,{show:n,onHide:function(){return c(!1)},kick:function(){return $()}}),Object(I.jsx)(H,{show:l,onHide:function(){return O(!1)},kick:function(){return $()}}),Object(I.jsx)(B,{show:m,onHide:function(){return g(!1)},kick:function(){return $()}})]}):Object(I.jsxs)(j.a,{children:[Object(I.jsx)("h1",{children:"Please enter the admin password"}),Object(I.jsxs)(R.a.Group,{className:"mt50 mb-3",children:[Y?Object(I.jsx)("div",{className:"mb10 error-message",children:"Session expired, please log in again"}):Object(I.jsx)(I.Fragment,{children:" "}),Object(I.jsxs)(b.a,{children:[Object(I.jsxs)(h.a,{xs:"9",md:"4",children:[Object(I.jsx)(R.a.Control,{type:"password",placeholder:"",readOnly:!!C,ref:q,onKeyPress:function(e){D(!1),"Enter"===e.key&&Q()},isInvalid:E}),Object(I.jsx)(R.a.Control.Feedback,{type:"invalid",children:U})]}),Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)(N.a,{onClick:function(){return Q()},type:"submit",disabled:!!C,children:"Login"})}),X?Object(I.jsx)(h.a,{xs:"auto",children:Object(I.jsx)(P.a,{animation:"border"})}):Object(I.jsx)(I.Fragment,{})]})]})]})]})};var K=function(){var e=s.a.useState(null),t=Object(i.a)(e,2);return t[0],t[1],Object(I.jsx)(o.a,{className:"App",children:Object(I.jsxs)(l.c,{children:[Object(I.jsx)(l.a,{path:"/admin",element:Object(I.jsx)(J,{})}),Object(I.jsx)(l.a,{path:"/",element:Object(I.jsx)(D,{})})]})})},V=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,463)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),n(e),s(e),c(e),r(e)}))};r.a.render(Object(I.jsx)(s.a.StrictMode,{children:Object(I.jsx)(K,{})}),document.getElementById("root")),V()}},[[438,1,2]]]);
//# sourceMappingURL=main.8357d313.chunk.js.map